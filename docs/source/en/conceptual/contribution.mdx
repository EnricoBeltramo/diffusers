<!--Copyright 2022 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->

# How to contribute to Diffusers üß®

We ‚ù§Ô∏è  contributions from the open-source community! Everyone is welcome, and all types of participation ‚Äìnot just code‚Äì are valued and appreciated. Answering questions, helping others, reaching out and improving the documentation are all immensely valuable to the community, so don't be afraid and get involved if you're up for it!

Everyone is encouraged to start by saying üëã in our public Discord channel. We discuss the hottest trends about diffusion models, ask questions, show-off personal projects, help each other with contributions, or just hang out ‚òï. <a href="https://discord.gg/G7tWnz98XR"><img alt="Join us on Discord" src="https://img.shields.io/discord/823813159592001537?color=5865F2&logo=discord&logoColor=white"></a>

Whichever way you choose to contribute, we strive to be part of an open, welcoming and kind community. Please, read our [code of conduct](https://github.com/huggingface/diffusers/blob/main/CODE_OF_CONDUCT.md) and be mindful to respect it during your interactions.

That being said, we enourmously value feedback from the community, so please do not be afraid to speak up if you believe you have valueable feedback that can help improve the library - every message, comment, issue and pull request (PR) is read and considered.

## Overview

You can contribute in many ways ranging from answering questions on issues to adding new diffusion models to 
the core library.

In the following, we give an overview of different ways to contribute, ranked by difficulty in ascending order.

* 1. Asking and answering questions on [the diffusers discussion forum](TODO:PVP) or on [discord](TODO:PVP).
* 2. Opening new issues on [the GitHub Issues tab](TODO:PVP)
* 3. Answering issues on [the GitHub Issues tab](TODO:PVP)
* 4. Fix a simple issue, marked by the "Good first issue" label, see [here](TODO:PVP).
* 5. Contribute to the [documentation](https://github.com/huggingface/diffusers/tree/main/docs/source).
* 6. Contribute a [Community Pipeline](TODO:PVP)
* 7. Contribute to the [examples](https://github.com/huggingface/diffusers/tree/main/examples).
* 8. Fix a more difficult issue, marked by the "Good second issue" label, see [here](TODO:PVP).
* 9. Add a new pipeline, model and, or pipeline, see ["New Pipeline/Model"](TODO:PVP) and ["New scheduler"](TODO:PVP) issues. For this contribution, please have a look at [Design Philosophy](TODO:PVP).

As said before, **all contributions are valuable to the community**.
In the following, we will explain each contribution a bit more in-detail.

For all contributions 4.-9. you will need to open a PR. It is explained in detail how to do so in [Opening a pull requst](TODO:PVP)

### 1. Asking and answering questions on [the diffusers discussion forum](TODO:PVP)

	The diffusers community is incentivized to ask any question related to the library and/or personal 
	projects built on top of the library on the `diffusers` [discussion forum](TODO:PVP) or the `diffusers` [discord channels](TODO:PVP) in an attempt to share 
	knowledge, receive help, network, or just to present personal projects. 
	Every questions that is asked on the forum or on discord, actively encourages the community to publicly 
	share knowledge and might very well help a beginner in the future that has the same question, you're 
	having. Please do pose any question you might have.
	In the same spirit, you are greatly helping the community by answering such questions as this way you are
	publicly documenting knowledge for everybody to learn from.

	**Please** keep in mind that the more effort you put into asking or answering a question, the higher 
	is the quality of the publicly documented knowledge. The same way, well-posed and well-answered questions    create a high quality knowledge database accesible to everybody, a badly posed question or answer reduces the overall quality of the public knowledge database. 
	In short, a high quality question or answer is *precise*, *concise*, *relevant*, *easy-to-understand*, *accesible*, and *well-formated/well-posed*. For more information, please have a look through the [How to write a good issue](#how-to-write-a-good-issue) section.

### 2. Opening new issues on the GitHub issues tab

	The üß® Diffusers library is robust and reliable thanks to the users who notify us of
	the problems they encounter. So thank you for reporting an issue.

    Remember, GitHub issues are reserved for technical questions directly related to the `diffusers` library, 	bug reports, feature requests, or feedback on the library design.

	In a nutshell, this means that everything that is **not** related to the **code of the diffusers library** should **not** be asked on GitHub, but rather on either the [forum](TODO:PVP) or [discord](TODO:PVP) as explained in [1.](TODO:PVP).

	**Please consider the following guidelines when open a new issue**:
	- Make sure you have searched whether your issue has already been asked before (use the search bar on GitHub under Issues).
	- Please never report a new issue on another (related) issue. If another issue is highly related, please
	open a new issue nevertheless and link to the related issue.
	- Make sure your issue is written in English. Plesae use on of the great, free online trasnlation services, such as [DeepL](TODO:PVP) to translate from your native language to English if you are not conformtible in English.
	- Check whether your issue might be solved by updating to the newest `diffusers` version. Before posting your issue, please make sure that `python -c "import diffusers; print(diffusers.__version__)"` is higher or matches the latest `diffusers` version.
	- Remember that the more effort you put into opening a new issue, the higher the quality of your answer will be and the better the overall quality of the `diffusers` issues.

New issues usually include the following.

#### 2.1. Reproducible, minimal bug reports.

A bug report should always have a reproducible code snippet and be as minimal and concise as possible.
This means in more detail:
- Narrow the bug down as much as you can, **do not just dump your whole code file**
- Format your code
- Do not include any external libraries except for `diffusers` depends on them.
- **Always** provide all necessary information about your environment; for this you can run: `diffusers-cli env` in your shell and copy-paste the displayed information to the issue.
- Explain the issue. If the reader doesn't know what the issue is and why it is an issue, she cannot solve it.
- **Always** make sure the reader can reproduce your issue with as little effort as possible. If you code snippet cannot be run because of missing libraries or undefined variables, the reader cannot help you.  Make sure your reproducible code snippet is as minimal as possible and can be copy-pasted into a simple Python shell.
- If in order to reproduce your issue a model and/or dataset is required make sure the reader has access to the model or dataset. You can always upload your model or dataset to the [Hub](https://huggingface.co) to make it easily downloadable. Try to keep your model and dataset as small as possible, to make the reproduction of your issue as effortless as possible.

For more information, please have a look through the [How to write a good issue](#how-to-write-a-good-issue) section.

You can open a bug report [here](TODO:PVP).

#### 2.2. Feature requests.

A world-class feature request addresses the following points:

1. Motivation first:
  * Is it related to a problem/frustration with the library? If so, please explain
    why. Providing a code snippet that demonstrates the problem is best.
  * Is it related to something you would need for a project? We'd love to hear
    about it!
  * Is it something you worked on and think could benefit the community?
    Awesome! Tell us what problem it solved for you.
2. Write a *full paragraph* describing the feature;
3. Provide a **code snippet** that demonstrates its future use;
4. In case this is related to a paper, please attach a link;
5. Attach any additional information (drawings, screenshots, etc.) you think may help.

You can open a feature request [here](TODO:PVP).

#### 2.3 Feedback. 

Feedback about the library design and why it is good or not good helps the core maintainers immensely to build a user-friendly library. To understand the philosohpy behind the current design philosophy, plesae have a look [here](TODO:PVP). If you feel like a certain design choice does not fit in with the current design philosophy, plesae explain why and how it should be changed. If a certain design choice follows the design philosophy too much, hence restricting use cases, explain why and how it should be changed. 
If a certain design choice is very useful for you, please also leave a not as this is great feedback for future design decisions.

You can open an issue about a feedback [here](TODO:PVP).

#### 2.4 Technical questions. 

Technical questions are mainly about why certain code of the library was written in a certain way, or what a certain part of the code does. Please make sure to link to the code in question and plesae provide detail on
why this part of the code is difficult to understand.

You can open an issue about a technical question [here](TODO:PVP).

#### 2.5 Proposal to add a new model, scheduler, or pipeline.

If the diffusion model community relesaed a new model, pipeline or scheduler that you would like to see in the `diffusers` library, please provide the following information:

* Short description of the diffusion pipeline, model or scheduler and link to the paper or public release.
* Link to the implementation if it is open-source;.
* Link to the model weights if they are available.

If you are willing to contribute the model yourself, let us know so we can best guide you. Also don't forget 
to tag the author by github handle if you can find it.

You can open a requests for a model/pipeline [here](TODO:PVP) and for a scheduler [here](TODO:PVP).

### 3. Answering issues on the GitHub issues tab

    Answering issues on GitHub might require some technical knowledge of `diffusers`, but we encourage everybody to give it a try even if you are not 100% certain that your answer is correct. 
	Some tips to give a high quality answer to an issue:
	- Be as concise and minimal as possible
	- Stay on topic. An answer to the issue should concern the issue and only the issue. 
	- Provide links to code, papers, or other sources that prove or encourage your point. 
	- Answer in code. If a simple code snippet is the answer to the issue or shows how the issue can be solved, please provide a fully reproducible code snippet.

	Also, many issues tend to be simply off-topic, duplicates of other issues or irrelevant. It is of great 
	help to the core-maintainers if you can answer to such issues, encouraging the author of the issue to be 
	more precise, provide the link to a duplicated issue or redirect them to [the forum](TODO:PVP) or [Discord](TODO:PVP)

	If you have verified that the issued bug report is correct and requires a correction in the source code, 
	please have a look at the [next sections](TODO:PVP).

For all of the following contributions, you will need to open a PR. It is explained in detail how to do so in [Opening a pull requst](TODO:PVP)

### 4. Fixing a [*Good first issue*](TODO:PVP)
	
	*Good first issues* are marked by the [Good first issue](TODO:PVP) label. Usually, the issue already 
	explains how a potential solution should look like so that it is easier to fix. 
	If the issue hasn't been closed and you would like to try to fix this issue, you can just leave a message "I would like to try this issue.". There are usually three scenarios:
	- a.) The issue description already proposes a fix. In this case and if the solution makes sense to you, you can open a PR or work-in-progress PR to fix it. 
	- b.) The issue description does not propose a fix. In this case, you can ask how a proposed fix could look like and someone should answer shortly. If you have a good idea on how to fix it, feel free to directly open a PR.
	- c.) There is already on open PR to fix the issue, but the issue hasn't been closed yet. If the PR has gone stale, you can simply open a new PR and link to the stale PR. PRs often go stale if the original contributor who wanted to fix the issue suddently cannot find the time anymore to proceed. This often happens in open-source and is very normal. In this case, the community will be very happy if you give it a new try and leverage knowledge of the existing PR. If there is already a PR and it is active, you can help the author by giving suggestions, reviewing the PR or even asking whether you can contribute to the PR.


### 5. Contribute to the [documentation](https://github.com/huggingface/diffusers/tree/main/docs/source).

	A good library **always** has good documentation! The official documentation is often one of the first point of contacts with a user of the library and therefore contributing to the documentation is a **highly 
	valuable contribution**.

	Contributing to the library can have many forms:

	- Correcting spelling or grammatical errors.
	- Correct incorrect formatting of the docstring. If you see that the official documentation is weirdly displayde or a link is broken, we are very happy if you take some time to correct it.
	- Correct the shape or dimensions of a docstring input or output tensor.
	- Clarify documentation that is hard to understand or incorrect
	- Update out-dated code examples.
	- Translating the documentation to another language. See [here](TODO:PVP) for more details.
	- etc...

	Anything displayed on [the official diffusers doc page](TODO:PVP) is part of the official documentation and can be corrected, adjusted in the respective [documentation source](TODO:PVP).

	Please have a look at [this page]( ) on how to verify changes changes made to the documentation locally.
	

### 6. Contribute a [community pipeline](https://github.com/huggingface/diffusers/tree/main/docs/source).

	[Pipelines](TODO:PVP) are usually the first point of contact between the diffusers library and the user.
	Pipelines are examples of how to use diffusers [models](TODO:PVP) and [schedulers](TODO:PVP).
	We support two types of pipelines:

		- Community Pipelines
		- Official Pipelines

	Both communtiy and official pipelines follow the same design and consists of the same type of components.

	Community pipeline are contributed and maintained purely by the **community** and are **not** tested. They 
	reside in [/examples/community]( ) and while they can be accesed via the pypi diffusers package (see [here]( )), their code is not part of the Pypi diffusers package.
	In contrast, official pipelines are tested and maintained by the core diffusers maintainers. Their code
	resides in [src/diffusers/pipelines]( ).

	The reason for the distinction is that the core `diffusers` team simply cannot maintain and test all 
	possible ways diffusion models can be used for inference. 
	Officially released diffusion pipelines, 
	such as [Stable Diffusion]( ) are added to the core src/diffusers/pipelines package which ensures a 
	high quality of maintenance, no backwards-breaking code changes and testing. 
	More edge-casy, unofficial pipelines should be added as community pipelines. If usage for a community pipeline is high, they pipeline can be moved to the official pipelines upon request from the community.

    To add a community pipeline, one should add a <name-of-the-community>.py file to [examples/community](TODO:PVP) and adapt the [examples/community/README.md](TODO:PVP) to include an example of the new pipeline.
	
	TODO(PVP:Copy&Paste test from the issue)

	Community pipeline PRs are only checked at a superficial level and it is desired to be maintained by the author.

	Contributing a community pipline is a great way to understand how to diffusers models and schedulers work. Having contributed a community pipeline is a great stepping stone to contribute an official pipeline to the 
	core package.

### 7. Contribute to the [examples](https://github.com/huggingface/diffusers/tree/main/examples).

### 8. Fixing a [*Good second issue*](TODO:PVP)

### 9. Add a [new pipeline, model](TODO:PVP), and/or [new scheduler](TODO:PVP).


## How to write a good issue

(TODO:PVP)
	
## How to open a PR - Step-by-step guide

Before writing code, we strongly advise you to search through the existing PRs or
issues to make sure that nobody is already working on the same thing. If you are
unsure, it is always a good idea to open an issue to get some feedback.

You will need basic `git` proficiency to be able to contribute to
üß® Diffusers. `git` is not the easiest tool to use but it has the greatest
manual. Type `git --help` in a shell and enjoy. If you prefer books, [Pro
Git](https://git-scm.com/book/en/v2) is a very good reference.

Follow these steps to start contributing ([supported Python versions](https://github.com/huggingface/diffusers/blob/main/setup.py#L212)):

1. Fork the [repository](https://github.com/huggingface/diffusers) by
   clicking on the 'Fork' button on the repository's page. This creates a copy of the code
   under your GitHub user account.

2. Clone your fork to your local disk, and add the base repository as a remote:

   ```bash
   $ git clone git@github.com:<your Github handle>/diffusers.git
   $ cd diffusers
   $ git remote add upstream https://github.com/huggingface/diffusers.git
   ```

3. Create a new branch to hold your development changes:

   ```bash
   $ git checkout -b a-descriptive-name-for-my-changes
   ```

   **Do not** work on the `main` branch.

4. Set up a development environment by running the following command in a virtual environment:

   ```bash
   $ pip install -e ".[dev]"
   ```

   (If Diffusers was already installed in the virtual environment, remove
   it with `pip uninstall diffusers` before reinstalling it in editable
   mode with the `-e` flag.)

   To run the full test suite, you might need the additional dependency on `transformers` and `datasets` which requires a separate source
   install:

   ```bash
   $ git clone https://github.com/huggingface/transformers
   $ cd transformers
   $ pip install -e .
   ```

   ```bash
   $ git clone https://github.com/huggingface/datasets
   $ cd datasets
   $ pip install -e .
   ```

   If you have already cloned that repo, you might need to `git pull` to get the most recent changes in the `datasets`
   library.

5. Develop the features on your branch.

   As you work on the features, you should make sure that the test suite
   passes. You should run the tests impacted by your changes like this:

   ```bash
   $ pytest tests/<TEST_TO_RUN>.py
   ```

   You can also run the full suite with the following command, but it takes
   a beefy machine to produce a result in a decent amount of time now that
   Diffusers has grown a lot. Here is the command for it:

   ```bash
   $ make test
   ```

   For more information about tests, check out the
   [dedicated documentation](https://huggingface.co/docs/diffusers/testing)

   üß® Diffusers relies on `black` and `isort` to format its source code
   consistently. After you make changes, apply automatic style corrections and code verifications
   that can't be automated in one go with:

   ```bash
   $ make style
   ```

   üß® Diffusers also uses `flake8` and a few custom scripts to check for coding mistakes. Quality
   control runs in CI, however you can also run the same checks with:

   ```bash
   $ make quality
   ```

   Once you're happy with your changes, add changed files using `git add` and
   make a commit with `git commit` to record your changes locally:

   ```bash
   $ git add modified_file.py
   $ git commit
   ```

   It is a good idea to sync your copy of the code with the original
   repository regularly. This way you can quickly account for changes:

   ```bash
   $ git pull upstream main
   ```

   Push the changes to your account using:

   ```bash
   $ git push -u origin a-descriptive-name-for-my-changes
   ```

6. Once you are satisfied (**and the checklist below is happy too**), go to the
   webpage of your fork on GitHub. Click on 'Pull request' to send your changes
   to the project maintainers for review.

7. It's ok if maintainers ask you for changes. It happens to core contributors
   too! So everyone can see the changes in the Pull request, work in your local
   branch and push the changes to your fork. They will automatically appear in
   the pull request.


### Checklist

1. The title of your pull request should be a summary of its contribution;
2. If your pull request addresses an issue, please mention the issue number in
   the pull request description to make sure they are linked (and people
   consulting the issue know you are working on it);
3. To indicate a work in progress please prefix the title with `[WIP]`. These
   are useful to avoid duplicated work, and to differentiate it from PRs ready
   to be merged;
4. Make sure existing tests pass;
5. Add high-coverage tests. No quality testing = no merge.
   - If you are adding new `@slow` tests, make sure they pass using
     `RUN_SLOW=1 python -m pytest tests/test_my_new_model.py`.
   - If you are adding a new tokenizer, write tests, and make sure
     `RUN_SLOW=1 python -m pytest tests/test_tokenization_{your_model_name}.py` passes.
   CircleCI does not run the slow tests, but GitHub actions does every night!
6. All public methods must have informative docstrings that work nicely with markdown. See `[pipeline_latent_diffusion.py](https://github.com/huggingface/diffusers/blob/main/src/diffusers/pipelines/latent_diffusion/pipeline_latent_diffusion.py)` for an example.
7. Due to the rapidly growing repository, it is important to make sure that no files that would significantly weigh down the repository are added. This includes images, videos and other non-text files. We prefer to leverage a hf.co hosted `dataset` like
   the ones hosted on [`hf-internal-testing`](https://huggingface.co/hf-internal-testing) in which to place these files and reference or [huggingface/documentation-images](https://huggingface.co/datasets/huggingface/documentation-images).
   If an external contribution, feel free to add the images to your PR and ask a Hugging Face member to migrate your images
   to this dataset.

### Tests

An extensive test suite is included to test the library behavior and several examples. Library tests can be found in
the [tests folder](https://github.com/huggingface/diffusers/tree/main/tests).

We like `pytest` and `pytest-xdist` because it's faster. From the root of the
repository, here's how to run tests with `pytest` for the library:

```bash
$ python -m pytest -n auto --dist=loadfile -s -v ./tests/
```

In fact, that's how `make test` is implemented!

You can specify a smaller set of tests in order to test only the feature
you're working on.

By default, slow tests are skipped. Set the `RUN_SLOW` environment variable to
`yes` to run them. This will download many gigabytes of models ‚Äî make sure you
have enough disk space and a good Internet connection, or a lot of patience!

```bash
$ RUN_SLOW=yes python -m pytest -n auto --dist=loadfile -s -v ./tests/
```

`unittest` is fully supported, here's how to run tests with it:

```bash
$ python -m unittest discover -s tests -t . -v
$ python -m unittest discover -s examples -t examples -v
```

### Syncing forked main with upstream (HuggingFace) main

To avoid pinging the upstream repository which adds reference notes to each upstream PR and sends unnecessary notifications to the developers involved in these PRs,
when syncing the main branch of a forked repository, please, follow these steps:
1. When possible, avoid syncing with the upstream using a branch and PR on the forked repository. Instead, merge directly into the forked main.
2. If a PR is absolutely necessary, use the following steps after checking out your branch:
```
$ git checkout -b your-branch-for-syncing
$ git pull --squash --no-commit upstream main
$ git commit -m '<your message without GitHub references>'
$ git push --set-upstream origin your-branch-for-syncing
```

### Style guide

For documentation strings, üß® Diffusers follows the [google style](https://google.github.io/styleguide/pyguide.html).


**This guide was heavily inspired by the awesome [scikit-learn guide to contributing](https://github.com/scikit-learn/scikit-learn/blob/main/CONTRIBUTING.md).**
